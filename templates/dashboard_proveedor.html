<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Proveedor - REPSE</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  background: linear-gradient(135deg, #ff6a00, #ff007b, #6600ff);
  background-size: 300% 300%;
  animation: grad 10s infinite;
  color: #fff;
}
@keyframes grad {50%{background-position:100% 50%;}}

.card {
  background:#fff;
  color:#333;
  border-radius:15px;
  padding:20px;
  margin-bottom:20px;
}
.table th {background:#ff6a00;color:white;}
</style>
</head>

<body>
<div class="container mt-4">
  <h3 class="text-white mb-4">Dashboard Proveedor</h3>

  <!-- CREAR PROYECTO -->
  <div class="card">
    <h5>Crear nuevo proyecto</h5>
    <form method="POST">
      <input type="hidden" name="action" value="create_project">
      <input type="text" name="project_name" class="form-control mb-2" required>
      <button class="btn btn-primary">Crear</button>
    </form>
  </div>

  {% for p in projects %}
  <div class="card">
    <h5>{{ p.name }} - {{ p.created_at }}</h5>

    <form method="POST" enctype="multipart/form-data">
      <input type="hidden" name="action" value="upload_doc">
      <input type="hidden" name="project_id" value="{{ p.id }}">

      <table class="table table-bordered">
        <thead><tr><th>Documento</th><th>Archivo</th><th>Estado</th></tr></thead>
        <tbody>
        {% for doc in DOCUMENTOS_OBLIGATORIOS %}
        <tr>
          <td>{{ doc }}</td>
          <td>
            {% set d = documentos_subidos.get(p.id, {}).get(doc) %}
            {% if d %}
              <a href="{{ s3_url(d.ruta) }}" target="_blank">{{ d.nombre_archivo }}</a>
            {% else %}
              <input type="file" name="documento">
              <input type="hidden" name="tipo_documento" value="{{ doc }}">
            {% endif %}
          </td>
          <td>{% if d %}✔️{% else %}❌ Pendiente{% endif %}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>

      <button class="btn btn-success">Subir/Actualizar</button>
    </form>
  </div>
  {% endfor %}

  <a href="{{ url_for('logout') }}" class="btn btn-secondary mt-3">Cerrar sesión</a>
</div>
</body>
</html>
