<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Requerimientos - REPSE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body{
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background: linear-gradient(135deg, #ff6a00, #ff007b, #6600ff);
      background-size:300% 300%;
      animation: gradientShift 10s ease infinite;
      color:#fff;
    }
    @keyframes gradientShift{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .card{
      width: 900px;
      max-width: 95vw;
      background: rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.25);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 12px 28px rgba(0,0,0,.18);
    }

    .title{
      font-weight:800;
      margin-bottom: 4px;
    }
    .subtitle{
      opacity: .95;
      margin-bottom: 16px;
    }

    label{font-weight:700;}
    .form-control, .form-select{
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.25);
    }

    .btn-primary{
      border-radius: 12px;
      font-weight: 800;
    }

    .pedido-row{
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.22);
      border-radius: 14px;
      padding: 12px;
      margin-top: 10px;
    }

    .text-darkish{ color: rgba(255,255,255,.95); }
    .hint{ font-size:.9rem; opacity:.9; }
  </style>
</head>
<body>

<div class="card">
  <h4 class="title text-darkish">Requerimientos del periodo</h4>
  <div class="subtitle text-darkish">
    Selecciona <b>año</b> y <b>mes</b>, indica cuántos pedidos registrarás y captura el número de pedido por cada uno.
  </div>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-warning">
        {% for m in messages %}{{ m }}<br>{% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" id="reqForm">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label text-darkish">Año</label>
        <input type="number" class="form-control" name="year" id="year" placeholder="2026" required>
      </div>

      <div class="col-md-4">
        <label class="form-label text-darkish">Mes</label>
        <select class="form-select" name="month" id="month" required>
          <option value="" selected disabled>Selecciona...</option>
          {% for k,v in months.items() %}
            <option value="{{ k }}">{{ v }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label text-darkish">¿Cuántos pedidos registrarás?</label>
        <input type="number" class="form-control" name="count" id="count" min="1" max="50" placeholder="Ej: 3" required>
        <div class="hint mt-1 text-darkish">Se crearán proyectos/pedidos para ese periodo.</div>
      </div>
    </div>

    <div id="pedidosContainer" class="mt-3"></div>

    <div class="d-flex gap-2 mt-3 flex-wrap">
  <button type="submit" class="btn btn-primary">Guardar y continuar</button>

  <!-- NUEVO: No registrar pedidos -->
  <a href="{{ url_for('dashboard_proveedor') }}" class="btn btn-secondary">
    No se registrarán nuevos pedidos
  </a>

  <a href="{{ url_for('logout') }}" class="btn btn-outline-light">Cerrar sesión</a>
</div>


<script>
  const container = document.getElementById('pedidosContainer');
  const countInput = document.getElementById('count');

  function renderPedidoInputs(n){
    container.innerHTML = '';
    if(!n || n < 1) return;

    for(let i=1; i<=n; i++){
      const div = document.createElement('div');
      div.className = 'pedido-row';

      div.innerHTML = `
        <div class="row g-2 align-items-end">
          <div class="col-md-6">
            <label class="form-label text-darkish">No. de pedido #${i}</label>
            <input type="text" class="form-control" name="pedido_no_${i}" placeholder="Ej: PED-000${i}" required>
          </div>
          <div class="col-md-6">
            <div class="hint text-darkish">
              Este pedido se convertirá en un proyecto del periodo seleccionado.
            </div>
          </div>
        </div>
      `;
      container.appendChild(div);
    }
  }

  countInput.addEventListener('input', () => {
    const n = parseInt(countInput.value || '0', 10);
    renderPedidoInputs(n);
  });
</script>

</body>
</html>
