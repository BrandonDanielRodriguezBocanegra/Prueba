<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Admin – REPSE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body>
<div class="container mt-4">

    <h2 class="mb-4">Panel del Administrador</h2>
    <a href="/logout" class="btn btn-danger mb-3">Cerrar sesión</a>

    <!-- Mensajes -->
    {% with mensajes = get_flashed_messages() %}
    {% if mensajes %}
        <div class="alert alert-info">{{ mensajes[0] }}</div>
    {% endif %}
    {% endwith %}

    <!-- PENDIENTES -->
    <div class="card mb-4">
        <div class="card-header bg-warning">Usuarios pendientes de aprobación</div>
        <div class="card-body">
            {% if pendientes %}
                <table class="table table-striped">
                    <tr><th>Nombre</th><th>Usuario</th><th></th></tr>
                    {% for u in pendientes %}
                    <tr>
                        <td>{{ u.nombre }}</td>
                        <td>{{ u.usuario }}</td>
                        <td>
                            <a href="/admin/accion/{{ u.id }}/aprobar" class="btn btn-success btn-sm">Aprobar</a>
                            <a href="/admin/accion/{{ u.id }}/rechazar" class="btn btn-danger btn-sm">Rechazar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>No hay usuarios pendientes</p>
            {% endif %}
        </div>
    </div>

    <!-- PROVEEDORES -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">Proveedores Aprobados</div>
        <div class="card-body">

            <table class="table table-bordered">
                <tr>
                    <th>Nombre</th>
                    <th>Correo</th>
                    <th>Proyectos</th>
                    <th>Acciones</th>
                </tr>

                {% for p in proveedores %}
                <tr>
                    <td>{{ p.nombre }}</td>
                    <td>{{ p.correo }}</td>

                    <td>
                        {% if proyectos_por_usuario[p.id] %}
                            <ul>
                            {% for proj in proyectos_por_usuario[p.id] %}
                               <li>{{ proj.name }} ({{ proj.created_at }})</li>
                            {% endfor %}
                            </ul>
                        {% else %}
                            <em>Sin proyectos</em>
                        {% endif %}
                    </td>

                    <td>
                        <a href="/eliminar_proveedor/{{ p.id }}" class="btn btn-danger btn-sm">Eliminar</a>
                    </td>
                </tr>
                {% endfor %}
            </table>

        </div>
    </div>

    <!-- RECORDATORIOS -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">Enviar Recordatorio</div>

        <div class="card-body">
            <form method="POST" action="/enviar_recordatorio">

                <label class="form-label">Seleccionar proveedores:</label>
                <select multiple name="proveedores" class="form-control mb-3" required>
                    {% for p in proveedores %}
                        <option value="{{ p.id }}">{{ p.nombre }} – {{ p.correo }}</option>
                    {% endfor %}
                </select>

                <label class="form-label">Mensaje:</label>
                <textarea class="form-control mb-3" name="mensaje" rows="3" required></textarea>

                <button class="btn btn-primary w-100">Enviar recordatorio</button>
            </form>
        </div>
    </div>

</div>
</body>
</html>
