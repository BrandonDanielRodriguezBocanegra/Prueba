<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Requerimientos - REPSE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #ff6a00, #ff007b, #6600ff);
      background-size: 300% 300%;
      animation: gradientShift 10s ease infinite;
      color: #fff;
      min-height: 100vh;
    }
    @keyframes gradientShift {
      0% { background-position:0% 50%; }
      50% { background-position:100% 50%; }
      100% { background-position:0% 50%; }
    }
    .card {
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .logout-btn {
      background-color: rgba(255,255,255,0.20);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.65);
      transition: all 0.3s ease;
      border-radius: 12px;
      padding: 10px 16px;
      text-decoration: none;
      display: inline-block;
    }
    .logout-btn:hover {
      background-color: rgba(255,255,255,0.95);
      color: #6600ff;
    }
  </style>
</head>
<body>
<div class="container mt-4">
  <h3 class="text-white mb-4">Requerimientos</h3>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-info">
        {% for m in messages %}{{ m }}<br>{% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="card">
    <h5 class="mb-3">Captura del periodo y pedidos</h5>

    <form method="POST" id="reqForm">
      <div class="row g-2">
        <div class="col-12 col-md-6">
          <label class="form-label fw-semibold">Año</label>
          <input type="number" class="form-control" name="periodo_year" value="{{ current_year }}" min="2000" max="2100" required>
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label fw-semibold">Mes</label>
          <select class="form-select" name="periodo_month" required>
            {% for mnum, mname in meses %}
              <option value="{{ mnum }}">{{ mname }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12">
          <label class="form-label fw-semibold mt-2">¿Cuántos proyectos/pedidos registrarás?</label>
          <input type="number" class="form-control" name="cantidad" id="cantidad" min="1" max="50" required>
          <div class="text-muted mt-1">Se desplegarán los campos para capturar No. de pedido.</div>
        </div>
      </div>

      <div id="pedidosContainer" class="mt-3"></div>

      <button type="submit" class="btn btn-primary mt-3">Guardar pedidos</button>
      <a href="{{ url_for('dashboard_proveedor') }}" class="btn btn-outline-secondary mt-3 ms-2">Ir al dashboard</a>
    </form>
  </div>

  <a href="{{ url_for('logout') }}" class="logout-btn mt-2">Cerrar sesión</a>
</div>

<script>
const cantidad = document.getElementById('cantidad');
const cont = document.getElementById('pedidosContainer');

function renderPedidos(n){
  cont.innerHTML = "";
  for(let i=1;i<=n;i++){
    const div = document.createElement('div');
    div.className = "mb-2";
    div.innerHTML = `
      <label class="form-label fw-semibold">No. de pedido ${i}</label>
      <input type="text" class="form-control" name="pedido_${i}" required>
    `;
    cont.appendChild(div);
  }
}

cantidad.addEventListener('input', () => {
  const n = parseInt(cantidad.value || "0", 10);
  if(n > 0 && n <= 50) renderPedidos(n);
  else cont.innerHTML = "";
});
</script>
</body>
</html>
