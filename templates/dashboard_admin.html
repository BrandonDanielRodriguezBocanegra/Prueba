<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administrador - REPSE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #ff6a00, #ff007b, #6600ff);
      background-size: 300% 300%;
      animation: gradientShift 10s ease infinite;
      color: #fff;
      min-height: 100vh;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .card {
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .table th { background-color: #ff6a00; color: white; }

    /* --- Pestañas --- */
    .nav-tabs {
      border-bottom: 3px solid rgba(255,255,255,0.3);
      margin-bottom: 15px;
    }
    .nav-tabs .nav-link {
      color: rgba(255,255,255,0.8);
      font-weight: 500;
      border: none;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    .nav-tabs .nav-link:hover {
      color: #fff;
      border-bottom: 3px solid rgba(255,255,255,0.5);
    }
    .nav-tabs .nav-link.active {
      color: #fff !important;
      background: transparent !important;
      border-bottom: 3px solid #fff;
      font-weight: bold;
    }

    /* --- Botón cerrar sesión --- */
    .logout-btn {
      background-color: rgba(255,255,255,0.2);
      color: #fff;
      border: 1px solid #fff;
      transition: all 0.3s ease;
    }
    .logout-btn:hover {
      background-color: #fff;
      color: #6600ff;
      border-color: #fff;
    }

    /* --- Eliminar el espacio inferior --- */
    .container {
      padding-bottom: 30px;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h3 class="text-white mb-4">Dashboard Administrador</h3>

    <!-- PESTAÑAS -->
    <ul class="nav nav-tabs" id="adminTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="proveedores-tab" data-bs-toggle="tab" data-bs-target="#proveedores" type="button" role="tab">Proveedores</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pendientes-tab" data-bs-toggle="tab" data-bs-target="#pendientes" type="button" role="tab">Usuarios Pendientes</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="gestion-tab" data-bs-toggle="tab" data-bs-target="#gestion" type="button" role="tab">Gestión de Usuarios</button>
      </li>
    </ul>

    <div class="tab-content">

      <!-- PESTAÑA PROVEEDORES -->
      <div class="tab-pane fade show active" id="proveedores" role="tabpanel">
        <div class="row my-3">
          <div class="col-md-4">
            <input type="text" id="searchProveedor" class="form-control" placeholder="Buscar proveedor...">
          </div>
          <div class="col-md-4">
            <select id="filtroProveedor" class="form-select">
              <option value="todos">Todos</option>
              <option value="aprobado">Aprobados</option>
              <option value="pendiente">No aprobados</option>
              <option value="alfabetico">Orden alfabético</option>
              <option value="reciente">Más reciente</option>
            </select>
          </div>
        </div>

        {% for p in proveedores %}
          <div class="card proveedor-card mb-3" data-nombre="{{ p['nombre'] }}">
            <h5>{{ p['nombre'] }} ({{ p['usuario'] }})</h5>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Documento</th>
                  <th>Archivo</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                {% for doc in DOCUMENTOS_OBLIGATORIOS %}
                <tr>
                  <td>{{ doc }}</td>
                  <td>
                    {% if documentos_por_usuario[p['id']].get(doc) %}
                      <a href="{{ url_for('descargar', filename=documentos_por_usuario[p['id']][doc]['nombre_archivo']) }}" class="btn btn-sm btn-primary">Descargar</a>
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>
                    {% if documentos_por_usuario[p['id']].get(doc) %}
                      ✅
                    {% else %}
                      ❌
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p>No hay proveedores registrados.</p>
        {% endfor %}
      </div>

      <!-- PESTAÑA USUARIOS PENDIENTES -->
      <div class="tab-pane fade" id="pendientes" role="tabpanel">
        {% if pendientes %}
        <table class="table table-bordered mt-3">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Usuario</th>
              <th>Correo</th>
              <th>Rol</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for p in pendientes %}
            <tr>
              <td>{{ p['nombre'] }}</td>
              <td>{{ p['usuario'] }}</td>
              <td>{{ p['correo'] }}</td>
              <td>{% if p['rol']==1 %}Admin{% else %}Proveedor{% endif %}</td>
              <td>
                <a href="{{ url_for('accion', id=p['id'], accion='aprobar') }}" class="btn btn-success btn-sm">Aprobar</a>
                <a href="{{ url_for('accion', id=p['id'], accion='rechazar') }}" class="btn btn-danger btn-sm">Rechazar</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>No hay usuarios pendientes.</p>
        {% endif %}
      </div>

      <!-- PESTAÑA GESTIÓN DE USUARIOS -->
      <div class="tab-pane fade" id="gestion" role="tabpanel">
        <p>Aquí se podrán eliminar proveedores (pendiente de implementación).</p>
      </div>
    </div>

    <a href="{{ url_for('logout') }}" class="btn logout-btn mt-3">Cerrar sesión</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // FILTRO Y BÚSQUEDA PROVEEDORES
    $('#searchProveedor').on('keyup', function() {
      let value = $(this).val().toLowerCase();
      $('.proveedor-card').filter(function() {
        $(this).toggle($(this).data('nombre').toLowerCase().indexOf(value) > -1)
      });
    });

    $('#filtroProveedor').on('change', function() {
      let filtro = $(this).val();
      let cards = $('.proveedor-card');

      if(filtro === 'todos') {
        cards.show();
      } else if(filtro === 'alfabetico') {
        cards.sort(function(a,b){
          return $(a).data('nombre').localeCompare($(b).data('nombre'));
        }).appendTo('.tab-pane#proveedores');
      }
    });
  </script>
</body>
</html>
